<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StoryMagic Pro - Custom Children's Books</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            text-align: center;
            padding: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
            min-height: 700px;
        }

        .form-section {
            padding: 30px;
            background: #f8f9fa;
            border-right: 2px solid #eee;
        }

        .preview-section {
            padding: 30px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .child-details {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .child-details h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .generate-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .generate-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .loading-spinner {
            display: none;
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }

        .story-display {
            display: none;
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .story-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .story-content {
            padding: 25px;
            text-align: center;
        }

        .story-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .story-text {
            font-size: 1.2em;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
        }

        .page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .nav-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn:hover:not(:disabled) {
            background: #44a08d;
            transform: translateY(-1px);
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .page-indicator {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .download-section {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .download-btn {
            background: white;
            color: #28a745;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            border-left: 5px solid #f44336;
        }

        .success-message {
            background: #e8f5e8;
            color: #2e7d32;
            border-left: 5px solid #4caf50;
        }

        .default-preview {
            text-align: center;
            color: #666;
        }

        .default-preview h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .preview-placeholder {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            margin: 20px auto;
            border: 5px solid white;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® StoryMagic Pro</h1>
            <p>Create Personalized Story Books for Any Child</p>
        </div>

        <div class="main-content">
            <div class="form-section">
                <h2 style="color: #333; margin-bottom: 25px; text-align: center;">Customize Your Book</h2>
                
                <div class="child-details">
                    <h4>üë∂ Child Information</h4>
                    
                    <div class="form-group">
                        <label for="childName">Child's Name</label>
                        <input type="text" id="childName" placeholder="Enter child's name" value="Dom">
                    </div>

                    <div class="form-group">
                        <label for="childAge">Age</label>
                        <select id="childAge">
                            <option value="3">3 years old</option>
                            <option value="4" selected>4 years old</option>
                            <option value="5">5 years old</option>
                            <option value="6">6 years old</option>
                            <option value="7">7 years old</option>
                            <option value="8">8 years old</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="childGender">Gender</label>
                        <select id="childGender">
                            <option value="girl" selected>Girl</option>
                            <option value="boy">Boy</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="hairColor">Hair Color</label>
                        <select id="hairColor">
                            <option value="black" selected>Black</option>
                            <option value="brown">Brown</option>
                            <option value="blonde">Blonde</option>
                            <option value="red">Red/Auburn</option>
                            <option value="curly brown">Curly Brown</option>
                            <option value="curly black">Curly Black</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="eyeColor">Eye Color</label>
                        <select id="eyeColor">
                            <option value="brown" selected>Brown</option>
                            <option value="blue">Blue</option>
                            <option value="green">Green</option>
                            <option value="hazel">Hazel</option>
                            <option value="dark brown">Dark Brown</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="storyTheme">üìö Choose Adventure</label>
                    <select id="storyTheme">
                        <option value="garden">üåª Magic Garden Adventure</option>
                        <option value="space">üöÄ Space Explorer Mission</option>
                        <option value="ocean">üåä Ocean Discovery Journey</option>
                        <option value="castle">üè∞ Brave Knight Quest</option>
                        <option value="pirate">üè¥‚Äç‚ò†Ô∏è Pirate Treasure Hunt</option>
                    </select>
                </div>

                <button class="generate-btn" onclick="generateStory()" id="generateBtn">
                    <div class="loading-spinner" id="loadingSpinner"></div>
                    <span id="btnText">üé® Create Custom Story!</span>
                </button>

                <div class="message success-message" id="successMessage"></div>
                <div class="message error-message" id="errorMessage"></div>
                
                <div class="download-section" id="downloadSection">
                    <h4>üìö Your Custom Book is Ready!</h4>
                    <p>Download the personalized story book</p>
                    <button class="download-btn" onclick="downloadPDF()">üìÑ Download PDF Book</button>
                </div>
            </div>

            <div class="preview-section">
                <div class="story-display" id="storyDisplay">
                    <img class="story-image" id="storyImage" alt="Story illustration">
                    <div class="story-content">
                        <div class="story-title" id="storyTitle">Story Title</div>
                        <div class="story-text" id="storyText">Story content will appear here...</div>
                        
                        <div class="page-navigation">
                            <button class="nav-btn" onclick="previousPage()" id="prevBtn">‚Üê Previous</button>
                            <span class="page-indicator" id="pageIndicator">Page 1 of 5</span>
                            <button class="nav-btn" onclick="nextPage()" id="nextBtn">Next ‚Üí</button>
                        </div>
                    </div>
                </div>

                <div class="default-preview" id="defaultPreview">
                    <div class="preview-placeholder" id="previewPlaceholder">üìñ</div>
                    <h3>Custom Story Preview</h3>
                    <p>Create a personalized story book with the child as the main character!</p>
                    <p style="margin-top: 15px; font-size: 0.9em;">Fill in the child's details and choose an adventure to begin.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        let currentStoryData = {};
        let currentPage = 0;

        const storyTemplates = {
            garden: {
                title: "{name}'s Magic Garden",
                pages: [
                    "{name} discovered a forgotten garden behind {his_her} house, where all the flowers looked sad and droopy.",
                    "With a special watering can, {name} carefully watered each flower, whispering words of encouragement.",
                    "Magically, the flowers began to bloom in brilliant colors, and butterflies started dancing around {name}!",
                    "{name} made friends with a wise old sunflower who taught {him_her} the secrets of caring for all living things.",
                    "{name} learned that with love and care, even the saddest garden can become a place of wonder and joy!"
                ],
                prompt: "A {age}-year-old {gender} with {hair_color} hair and {eye_color} eyes, in a magical garden filled with colorful blooming flowers and butterflies, children's book illustration style, bright and cheerful"
            },
            space: {
                title: "{name} the Space Explorer",
                pages: [
                    "{name} built a rocket ship in {his_her} backyard and zoomed off to explore the stars and planets.",
                    "On {his_her} first stop, the Moon, {name} met friendly alien creatures who spoke in musical tones.",
                    "{name} helped the aliens fix their broken space station using {his_her} clever problem-solving skills.",
                    "Together, they traveled to different planets, discovering amazing space crystals and cosmic flowers.",
                    "{name} returned home with new friends and learned that the universe is full of kindness and wonder!"
                ],
                prompt: "A {age}-year-old {gender} with {hair_color} hair and {eye_color} eyes, wearing a colorful space suit, floating among stars and planets with friendly aliens, children's book illustration style, cosmic adventure"
            },
            ocean: {
                title: "{name}'s Ocean Adventure",
                pages: [
                    "{name} dove into the crystal-clear ocean and discovered {he_she} could breathe underwater like a mermaid!",
                    "Swimming deeper, {name} found a little dolphin who was lost and couldn't find {his_her} family.",
                    "{name} bravely offered to help and together they searched through coral reefs and underwater caves.",
                    "They met wise sea turtles and playful seahorses who all joined the search for the dolphin's family.",
                    "When they found the dolphin family, everyone celebrated, and {name} learned that helping others brings the greatest joy!"
                ],
                prompt: "A {age}-year-old {gender} with {hair_color} hair and {eye_color} eyes, swimming underwater with dolphins and colorful fish in a bright coral reef, children's book illustration style, underwater adventure"
            },
            castle: {
                title: "{name} the Brave Knight",
                pages: [
                    "Knight {name} put on shiny armor and set out on a quest to help a village troubled by a sad dragon.",
                    "Instead of fighting, brave {name} decided to talk to the dragon and discover why {he_she} was so unhappy.",
                    "The dragon explained that {he_she} was lonely and just wanted friends to play with and share stories.",
                    "{name} invited the dragon to the village, where everyone learned that {he_she} was kind and gentle.",
                    "The village threw a big celebration, and {name} learned that understanding and kindness are the greatest strengths!"
                ],
                prompt: "A {age}-year-old {gender} with {hair_color} hair and {eye_color} eyes, dressed as a knight with shiny armor, standing with a friendly dragon near a colorful castle, children's book illustration style, medieval fantasy"
            },
            pirate: {
                title: "Captain {name}'s Treasure",
                pages: [
                    "Captain {name} set sail on {his_her} colorful pirate ship to find the legendary Treasure of Friendship.",
                    "Following an old treasure map, {name} arrived at a mysterious island filled with other young pirates.",
                    "But these pirates were hungry and had been searching for food, not gold or jewels.",
                    "Captain {name} shared {his_her} ship's supplies and discovered that sharing made everyone happier than any treasure.",
                    "{name} learned that the real treasure was the new friendships {he_she} made and the joy of helping others!"
                ],
                prompt: "A {age}-year-old {gender} with {hair_color} hair and {eye_color} eyes, dressed as a friendly pirate captain on a colorful ship with treasure chests and other young pirates, children's book illustration style, adventure and friendship"
            }
        };

        async function generateStory() {
            const name = document.getElementById('childName').value.trim() || 'Alex';
            const age = document.getElementById('childAge').value;
            const gender = document.getElementById('childGender').value;
            const hairColor = document.getElementById('hairColor').value;
            const eyeColor = document.getElementById('eyeColor').value;
            const theme = document.getElementById('storyTheme').value;
            
            if (!name) {
                showError('Please enter the child\'s name!');
                return;
            }

            const btn = document.getElementById('generateBtn');
            const spinner = document.getElementById('loadingSpinner');
            const btnText = document.getElementById('btnText');
            
            btn.disabled = true;
            spinner.style.display = 'block';
            btnText.textContent = `Creating ${name}'s Story...`;

            hideMessages();

            try {
                const template = storyTemplates[theme];
                
                // Create personalized story
                const personalizedStory = {
                    title: personalizeText(template.title, name, gender),
                    pages: template.pages.map(page => personalizeText(page, name, gender))
                };

                // Create AI prompt
                const aiPrompt = personalizeText(template.prompt, name, gender)
                    .replace('{age}', age)
                    .replace('{gender}', gender)
                    .replace('{hair_color}', hairColor)
                    .replace('{eye_color}', eyeColor);

                // Try to generate AI image
                let imageUrl = null;
                try {
                    const response = await fetch('/api/generate-image', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            prompt: aiPrompt,
                            size: "1024x1024",
                            quality: "standard",
                            style: "vivid"
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        imageUrl = data.url || data.data?.[0]?.url || data.image_url;
                    }
                } catch (aiError) {
                    console.log('AI generation failed, using fallback');
                }

                // If AI fails, create custom illustration
                if (!imageUrl) {
                    imageUrl = createCustomIllustration(name, age, gender, hairColor, eyeColor, theme);
                }

                // Store story data
                currentStoryData = {
                    name,
                    age,
                    gender,
                    hairColor,
                    eyeColor,
                    theme,
                    title: personalizedStory.title,
                    pages: personalizedStory.pages,
                    imageUrl
                };

                currentPage = 0;
                displayStory();
                
                showSuccess(`üéâ ${name}'s personalized story book is ready! Navigate through all 5 pages.`);

            } catch (error) {
                console.error('Error:', error);
                showError(`Failed to create story: ${error.message}`);
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                btnText.textContent = 'üé® Create Custom Story!';
            }
        }

        function personalizeText(text, name, gender) {
            const pronouns = gender === 'girl' 
                ? { his_her: 'her', him_her: 'her', he_she: 'she' }
                : { his_her: 'his', him_her: 'him', he_she: 'he' };
            
            return text
                .replace(/{name}/g, name)
                .replace(/{his_her}/g, pronouns.his_her)
                .replace(/{him_her}/g, pronouns.him_her)
                .replace(/{he_she}/g, pronouns.he_she);
        }

        function createCustomIllustration(name, age, gender, hairColor, eyeColor, theme) {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 800;
            const ctx = canvas.getContext('2d');

            // Theme backgrounds
            const themes = {
                garden: { bg: ['#87CEEB', '#90EE90'], accent: '#FFB6C1' },
                space: { bg: ['#191970', '#4B0082'], accent: '#FFD700' },
                ocean: { bg: ['#00CED1', '#1E90FF'], accent: '#FF7F50' },
                castle: { bg: ['#DDA0DD', '#9370DB'], accent: '#FFD700' },
                pirate: { bg: ['#8B4513', '#CD853F'], accent: '#FFD700' }
            };

            const themeData = themes[theme];
            
            // Background
            const gradient = ctx.createLinearGradient(0, 0, 800, 800);
            gradient.addColorStop(0, themeData.bg[0]);
            gradient.addColorStop(1, themeData.bg[1]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 800);

            // Character
            const centerX = 400;
            const centerY = 350;
            const scale = 1.2;

            // Skin tone
            ctx.fillStyle = '#F4C2A1';
            ctx.beginPath();
            ctx.arc(centerX, centerY - 100 * scale, 80 * scale, 0, 2 * Math.PI);
            ctx.fill();

            // Hair
            const hairColors = {
                black: '#1C1C1C',
                brown: '#8B4513',
                blonde: '#FFD700',
                red: '#CD853F',
                'curly brown': '#8B4513',
                'curly black': '#1C1C1C'
            };
            
            ctx.fillStyle = hairColors[hairColor];
            ctx.beginPath();
            ctx.arc(centerX, centerY - 130 * scale, 90 * scale, 0, Math.PI);
            ctx.fill();

            // Eyes
            const eyeColors = {
                brown: '#8B4513',
                blue: '#4169E1',
                green: '#228B22',
                hazel: '#8B7355',
                'dark brown': '#654321'
            };
            
            ctx.fillStyle = eyeColors[eyeColor];
            ctx.beginPath();
            ctx.arc(centerX - 25 * scale, centerY - 120 * scale, 8 * scale, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(centerX + 25 * scale, centerY - 120 * scale, 8 * scale, 0, 2 * Math.PI);
            ctx.fill();

            // Smile
            ctx.strokeStyle = '#D2691E';
            ctx.lineWidth = 4 * scale;
            ctx.beginPath();
            ctx.arc(centerX, centerY - 80 * scale, 20 * scale, 0, Math.PI);
            ctx.stroke();

            // Body/outfit
            ctx.fillStyle = themeData.accent;
            ctx.beginPath();
            ctx.arc(centerX, centerY + 50 * scale, 100 * scale, 0, Math.PI);
            ctx.fill();

            // Name
            ctx.fillStyle = '#FFFFFF';
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 3;
            ctx.font = `bold ${40 * scale}px Comic Sans MS`;
            ctx.textAlign = 'center';
            ctx.strokeText(name, centerX, 750);
            ctx.fillText(name, centerX, 750);

            return canvas.toDataURL('image/png');
        }

        function displayStory() {
            document.getElementById('defaultPreview').style.display = 'none';
            document.getElementById('storyDisplay').style.display = 'block';
            document.getElementById('downloadSection').style.display = 'block';
            updatePage();
        }

        function updatePage() {
            const image = document.getElementById('storyImage');
            const title = document.getElementById('storyTitle');
            const text = document.getElementById('storyText');
            const indicator = document.getElementById('pageIndicator');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            image.src = currentStoryData.imageUrl;
            title.textContent = currentStoryData.title;
            text.textContent = currentStoryData.pages[currentPage];
            indicator.textContent = `Page ${currentPage + 1} of ${currentStoryData.pages.length}`;
            
            prevBtn.disabled = currentPage === 0;
            nextBtn.disabled = currentPage === currentStoryData.pages.length - 1;
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                updatePage();
            }
        }

        function nextPage() {
            if (currentPage < currentStoryData.pages.length - 1) {
                currentPage++;
                updatePage();
            }
        }

        async function downloadPDF() {
            if (!currentStoryData.title) {
                alert('Please generate a story first!');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                // Cover page
                pdf.setFillColor(255, 248, 220);
                pdf.rect(0, 0, 210, 297, 'F');
                
                pdf.setTextColor(50, 50, 150);
                pdf.setFontSize(28);
                pdf.setFont(undefined, 'bold');
                pdf.text(currentStoryData.title, 105, 50, { align: 'center' });
                
                pdf.setFontSize(18);
                pdf.text(`A Custom Story for ${currentStoryData.name}`, 105, 70, { align: 'center' });
                
                // Add character image if available
                try {
                    pdf.addImage(currentStoryData.imageUrl, 'PNG', 55, 90, 100, 100);
                } catch (e) {
                    // Simple character representation
                    pdf.setFillColor(244, 194, 161);
                    pdf.circle(105, 140, 40, 'F');
                    pdf.setFontSize(14);
                    pdf.text(`${currentStoryData.name}, age ${currentStoryData.age}`, 105, 200, { align: 'center' });
                }

                // Story pages
                currentStoryData.pages.forEach((pageText, index) => {
                    pdf.addPage();
                    
                    // Background
                    const colors = [[255, 248, 220], [240, 248, 255], [245, 255, 250], [255, 240, 245], [248, 248, 255]];
                    const color = colors[index % colors.length];
                    pdf.setFillColor(color[0], color[1], color[2]);
                    pdf.rect(0, 0, 210, 297, 'F');
                    
                    // Page header
                    pdf.setTextColor(50, 50, 150);
                    pdf.setFontSize(20);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(`Page ${index + 1}`, 105, 30, { align: 'center' });
                    
                    // Character image
                    try {
                        pdf.addImage(currentStoryData.imageUrl, 'PNG', 75, 50, 60, 60);
                    } catch (e) {
                        pdf.setFillColor(244, 194, 161);
                        pdf.circle(105, 80, 25, 'F');
                    }
                    
                    // Story text
                    pdf.setFillColor(255, 255, 255, 0.9);
                    pdf.rect(20, 130, 170, 80, 'F');
                    pdf.setDrawColor(150, 150, 150);
                    pdf.rect(20, 130, 170, 80, 'S');
                    
                    pdf.setTextColor(50, 50, 50);
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'normal');
                    const lines = pdf.splitTextToSize(pageText, 150);
                    let yPos = 150;
                    lines.forEach(line => {
                        if (yPos < 200) {
                            pdf.text(line, 105, yPos, { align: 'center' });
                            yPos += 8;
                        }
                    });
                });

                pdf.save(`${currentStoryData.name}_Custom_Story_Book.pdf`);
                alert('üìö Custom story book downloaded successfully!');
                
            } catch (error) {
                console.error('PDF error:', error);
                alert('‚ùå Failed to create PDF. Please try again.');
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.style.display = 'block';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        // Update preview when form changes
        document.getElementById('childName').addEventListener('input', updatePreview);
        document.getElementById('childGender').addEventListener('change', updatePreview);
        document.getElementById('storyTheme').addEventListener('change', updatePreview);

        function updatePreview() {
            const name = document.getElementById('childName').value || 'Child';
            const theme = document.getElementById('storyTheme').value;
            const themeEmojis = {
                garden: 'üåª',
                space: 'üöÄ',
                ocean: 'üåä',
                castle: 'üè∞',
                pirate: 'üè¥‚Äç‚ò†Ô∏è'
            };
            
            document.getElementById('previewPlaceholder').textContent = themeEmojis[theme];
        }
    </script>
</body>
</html>
